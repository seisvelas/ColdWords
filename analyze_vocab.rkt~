#lang racket

(require db)
(require db/util/postgresql)


; Postgres credentials
(define USER "alejandroalvarado")
(define DATABASE "postgres")
(define PASSWORD "Blueberry1.fl33021")
(define SERVER "sqltoys.c8zqxwrzvnem.us-east-2.rds.amazonaws.com")


(define WORD-ARRAYS-QUERY
  (file->string "word_arrays.sql"))

(define SMALLEST-IDEOLOGY-QUERY
  (file->string "smallest_ideology.sql"))

(define pgc
    (postgresql-connect #:user USER
                        #:database DATABASE
                        #:password PASSWORD
                        #:server SERVER))

(define (analyze-wordset wordset)
  (let ((ideology (vector-ref wordset 0))
        (words (pg-array->list (vector-ref wordset 1))))
    (list ideology
          (exact->inexact
           (/ (length (remove-duplicates words))
              (length words))))))

; returns big lists of all words found for each ideology 
(let* ((ideologies-words (query-rows pgc WORD-ARRAYS-QUERY)))
  (display (map analyze-wordset
       ideologies-words)))